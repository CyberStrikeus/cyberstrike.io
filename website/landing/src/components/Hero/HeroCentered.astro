---
/**
 * * Hero centered with video button
 *
 * There is a commented out "awards" section below in case you want that
 */
import Button from "@components/Button/Button.astro";
import { getLocaleFromUrl } from "@js/localeUtils";
import { useTranslations } from "@js/translationUtils";
import { Icon } from "astro-icon/components";

import { getLocalizedRoute } from "@/js/translationUtils";

const currLocale = getLocaleFromUrl(Astro.url);
const t = useTranslations(currLocale);
---

<section id="hero-center" class="dark relative overflow-hidden pt-14">
  <div class="dark:bg-dark-bg">
    <!-- bg neon arc -->
    <div class="absolute -inset-x-10 top-20 opacity-70 md:-inset-x-14 md:top-32 xl:-bottom-30">
      <div class="mx-auto flex h-full w-full max-w-[1800px] items-end justify-center">
        <Icon
          is:inline
          name="amplify/neon-arc"
          aria-hidden="true"
          class="text-primary-500 h-full w-full xl:scale-y-[1.1]"
        />
      </div>
    </div>

    <!-- main content -->
    <div class="site-container relative mx-auto px-4 pt-16 pb-12 md:pb-20">
      <!-- alter the max-w-[750px] here until your text looks nice on large screens -->
      <div class="mx-auto flex w-full max-w-[750px] flex-col justify-center px-4 text-center">
        <div data-mos="fade-up" data-mos-anchor="#hero-center">
          <!-- <Badge>Meet Amplify</Badge> -->
          <!-- notification -->
          <div class="mb-4 flex w-full items-center justify-center">
            <a
              href="https://docs.cyberstrike.io/changelog"
              target="_blank"
              rel="noopener noreferrer"
              class="hover-border-glow border-base-200 bg-base-100 text-base-700 dark:border-base-800 dark:bg-base-950 dark:text-base-300 flex items-center rounded-full border px-4 py-1 text-sm"
            >
              <span class="flex items-center gap-2">
                <Icon name="tabler/sparkles" class="text-primary-500 inline size-4" aria-hidden="true" />
                Now with Claude 3.5 Sonnet support
              </span>
            </a>
          </div>

          <h1 class="h1 mb-6">
            {t("hero_text")}
          </h1>
        </div>
        <p
          class="text-base-600 dark:text-base-100 mx-auto mb-10 max-w-3xl text-lg text-pretty"
          data-mos="fade-up"
          data-mos-delay=".1"
          data-mos-anchor="#hero-center"
        >
          {t("hero_description")}
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <div data-mos="fade-up" data-mos-delay=".2" data-mos-anchor="#hero-center">
            <Button
              variant="primary"
              href="https://docs.cyberstrike.io/getting-started"
              target="_blank"
              rel="noopener noreferrer"
            >
              Get Started
            </Button>
          </div>

          <div data-mos="fade-up" data-mos-delay=".2" data-mos-anchor="#hero-center">
            <Button
              variant="outline"
              id="video-btn"
              class="dark:border-base-600 dark:text-base-100 cursor-not-allowed opacity-50"
              disabled
            >
              <Icon name="tabler/player-play" class="size-5 mr-1" aria-hidden="true" />
              Watch Video (Coming Soon)
            </Button>
          </div>
        </div>

        <!-- GitHub stats -->
        <div
          class="mx-auto mt-8 flex justify-center"
          data-mos="fade-up"
          data-mos-delay=".3"
          data-mos-anchor="#hero-center"
        >
          <a
            id="github-repo-link"
            href="https://github.com/CyberStrikeus/cyberstrike.io"
            target="_blank"
            rel="noopener noreferrer"
            class="hover-border-glow border-base-700 bg-base-900/50 dark:border-base-700 dark:bg-base-950/50 flex items-center gap-4 rounded-full border px-5 py-2"
          >
            <div class="flex items-center gap-2">
              <Icon name="tabler/brand-github" class="size-5 text-base-300" aria-hidden="true" />
              <span class="text-base-200 font-medium">CyberStrikeus/cyberstrike.io</span>
            </div>
            <div class="flex items-center gap-3 text-sm">
              <span class="text-base-400 flex items-center gap-1">
                <Icon name="tabler/star" class="size-4 text-yellow-400" aria-hidden="true" />
                <span id="github-stars">-</span>
              </span>
            </div>
          </a>
        </div>

<script>
  async function fetchGitHubStars() {
    try {
      const response = await fetch('https://api.github.com/repos/CyberStrikeus/cyberstrike.io');
      const data = await response.json();
      const starsEl = document.getElementById('github-stars');
      if (starsEl && data.stargazers_count !== undefined) {
        starsEl.textContent = data.stargazers_count.toLocaleString();
      }
    } catch (error) {
      console.error('Failed to fetch GitHub stars:', error);
    }
  }

  // Fetch on page load
  fetchGitHubStars();

  // Refresh on view transitions
  document.addEventListener('astro:after-swap', fetchGitHubStars);

  // Video modal
  const videoBtn = document.getElementById('video-btn');
  const videoModal = document.getElementById('video-modal');
  const videoClose = document.getElementById('video-close');
  const videoIframe = document.getElementById('video-iframe') as HTMLIFrameElement;

  videoBtn?.addEventListener('click', () => {
    videoModal?.classList.remove('hidden');
    videoModal?.classList.add('flex');
    document.body.style.overflow = 'hidden';
  });

  function closeModal() {
    videoModal?.classList.add('hidden');
    videoModal?.classList.remove('flex');
    document.body.style.overflow = '';
    if (videoIframe) {
      const src = videoIframe.src;
      videoIframe.src = '';
      videoIframe.src = src;
    }
  }

  videoClose?.addEventListener('click', closeModal);
  videoModal?.addEventListener('click', (e) => {
    if (e.target === videoModal) closeModal();
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal();
  });
</script>
      </div>
    </div>
  </div>

  <!-- Video Modal -->
  <div
    id="video-modal"
    class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 backdrop-blur-sm"
  >
    <div class="relative w-full max-w-4xl mx-4">
      <button
        id="video-close"
        class="absolute -top-12 right-0 text-white hover:text-primary-400 transition-colors"
        aria-label="Close video"
      >
        <Icon name="tabler/x" class="size-8" />
      </button>
      <div class="relative aspect-video w-full rounded-lg overflow-hidden bg-base-900">
        <iframe
          id="video-iframe"
          src="https://www.youtube.com/embed/dQw4w9WgXcQ"
          title="Cyberstrike Demo Video"
          class="absolute inset-0 w-full h-full"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        ></iframe>
      </div>
    </div>
  </div>
</section>
